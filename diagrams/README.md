### Что не так с текущей архитектурой
- нет никакого учета юзеров, нет личного кабинета
- нет возможности юзеру добавить устройство самому
- поддерживается только 2 типа устройств
- много синхронных вызовов, что в будущем будет  сильно мешать масштабированию
- нет админки для сотрудников Теплого дома, чтобы добавлять новые типы поддерживаемых устройств
- нет нотификации юзеров о происходящем в доме

### Что предлагается сделать
- выделяем 2 домена - управление пользователями, управление устройствами и датчиками,
  добавляем асинхронное взаимодействие с датчиками
- добавляем микросервис users для учета юзеров, авторизации и работы с ЛК
- существующий монолит дорабатывам: добавляем поддержку новых классов устройств (новые таблицы в бд и новая логика обработки данных)
  Предполагается, что количество классов устройств не исчисляется сотнями, при этом устройства достаточно разные по набору параметров (сложно сравнить ворота и камеру, например)
  поэтому делаем разные таблицы и обработчики по типам устройств, а не пишем все в одну таблицу с кучей необязательных полей
- данные с датчиков, устройств, камер - с ростом системы их будет очень много (много устройств х высокая частота опроса), поэтому будем собирать их и агрегировать через высокопроизводительный
  брокер (Kafka)

### Пользовательский путь
- юзер регистрируется в сервисе
- юзер покупает физические устройства (из списка поддерживаемых системой)
- устанавливает, подключает к интернету
- заходит в личный кабинет
- создает себе дом
- к дому в личном кабинете привязывает установленные устройства
- видит их показания и статус, задает им команды

### Описание работы системы
- у каждого типа устройств есть некий сервис-адаптер, устанавливающий соединение с устройством через интернет
- адаптер получает или отправляет данные на устройство, преобразовывая их в удобоваримый для сервиса/устройства вид
  таким образом обеспечивается поддержка зоопарка моделей устройств одного типа
- полученные данные отправляются в кафку, откуда их потребляет основной сервис (бывший монолит), который выполняет основную логику
  (например, рассчитывает ПИД-регулятор для поддержания постоянной температуры в помещении). Так же можно собирать данные в таблицу, статистику выводить
- в бд сервиса есть сущность дом, который соединен как один-ко-многим к разным видам устройств, так же у дома проставлен id юзера-хозяина (многие-ко-многим косвенно)
- предусмотрен справочник статусов устройств
- наружу выходит REST API, позволяющее создавать новые дома, подключать/отключать устройства от дома, менять уставки
- на этот АПИ юзер ходит по токену, полученному у сервиса User, полученному после аутентификации

### Еще можно добавить
- нотификацию юзеров при критических значениях показаний или по каким то еще событиям
- отправку смсок для регистрации (2FA)
- админку, чтобы сотрудник конторы мог видеть статистику, добавлять новые поддерживаемые модели